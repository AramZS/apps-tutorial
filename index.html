<!DOCTYPE html>
<html>
    <head>

        <style>
            @import url('sp://tutorial/css/main.css');
            @import url('$views/css/image.css');
            @import url('sp://tutorial/css/github.css');
        </style>
        <script src="sp://tutorial/js/rainbow-custom.min.js"></script>
        <script src="sp://tutorial/js/tutorial.js"></script>
    </head>
    <body>
        <div id="wrapper">

        <div id="index" class="section">

            <h1>Spotify Apps API Tutorials</h1>
            <img src="sp://tutorial/img/spotify-char.png" class="right" />
            <h4>Getting started</h4>
            <ul>
                <li><a href="spotify:app:tutorial:manifest">Creating your manifest file</a></li>
                <li><a href="spotify:app:tutorial:tabs">Handling arguments, creating pages and navigational tabs</a></li>
                <li><a href="spotify:app:tutorial:drop">Dragging and dropping content into an app</a> (Unstable)</li>
                <li><a href="spotify:app:tutorial:share">Show "Share" popup</a></li>
            </ul>

            <h4>UI</h4>
            <ul>
                <li><a href="sp://tutorial/tutorials/buttons.html">Using standard components for buttons</a> (Unstable)</li>
            </ul>

            <h4>Playing music</h4>
            <ul>
                <li><a href="spotify:app:tutorial:play_single_track">Play a single track</a></li>
                <li><a href="spotify:app:tutorial:play_list_of_tracks">Play a list of tracks</a> (Unstable)</li>
                <li><a href="spotify:app:tutorial:current_track">Get the currently-playing track</a></li>
                <li><a href="sp://tutorial/tutorials/click_to_play.html">Create a play/pause button with an HTML element</a> (Unstable)</li>
                <li><a href="sp://tutorial/tutorials/skip_track.html">Skip to the next or previous track</a> (Unstable)</li>
                <li><a href="sp://tutorial/tutorials/user_toplist.html">Get a user's top tracks</a> (Unstable)</li>
            </ul>

            <h4>Searching</h4>
            <ul>
                <li><a href="sp://tutorial/tutorials/search.html">Returning all tracks with a given search query</a> (Unstable)</li>
                <li><a href="sp://tutorial/tutorials/search_albums_for_an_artist.html">Search albums for an artist</a> (Unstable)</li>
            </ul>


            <h4>Playlists</h4>
            <ul>
                <li><a href="sp://tutorial/tutorials/add_track_to_playlist.html">Add a track to a playlist</a> (Unstable)</li>
                <li><a href="sp://tutorial/tutorials/get_tracks_from_playlist.html">Get tracks from a playlist URL</a> (Unstable)</li>
                <li><a href="sp://tutorial/tutorials/subscribe.html">Subscribe to a playlist</a> (Unstable)</li>
                <li><a href="sp://tutorial/tutorials/playlist_mosaic.html">Showing a playlist mosiac image</a> (Unstable)</li>
            </ul>

            <h4>Interacting with Facebook</h4>
            <ul>
                <li><a href="sp://tutorial/tutorials/Facebook_auth.html">Authenticate a user with Facebook</a> (Unstable)</li>
                <li><a href="sp://tutorial/tutorials/Facebook_get_listening_history.html">Get a user's listening history from Facebook</a> (Unstable)</li>
            </ul>

            <h4>Experimental &amp; Unsupported</h4>
            <ul>
                <li><a href="sp://tutorial/tutorials/twitter.html">Talking to Twitter</a></li>
                <li><a href="sp://tutorial/tutorials/echonest.html">Create an EchoNest radio station</a></li>
                <li><a href="sp://tutorial/tutorials/polymaps.html">Display a Polymaps object</a></li>
                <li><a href="sp://tutorial/tutorials/google_maps.html">Display a Google Maps object</a></li>
                <li><a href="sp://tutorial/tutorials/template.html">Template</a></li>
            </ul>

        </div><!-- /index -->

        <div id="tabs" class="section">

            <h1>Handling arguments, creating pages and navigational tabs</h1>
            <p class="description">Your Spotify app should be one HTML page that shows and hides sections. In the manifest.json file, you can update the <code>DefaultTabs</code> property with arguments that corespond to nagivational tab names. In the <code>Application</code> class, when tabs or page links are clicked, the arguments property is updated. In this example, we are simply showing and hiding a &lt;div /&gt; element each time the arguments are updated.</p>

            <h3>The manifest.json snippet</h3>
            <div class="code-block">
<pre><code data-language="javascript">{
    ...
    "DefaultTabs": [
        {
            "arguments": "index",
            "title": {
                "en": "Home"
            }
        },
        {
            "arguments": "tabs",
            "title": {
                "en": "How to use tabs"
            }
        }
    ],
    "Dependencies": {
        "api": "1.0.0",
        "views": "1.0.0",
        "resources": "0.2.2"
    },
    ...
}</code></pre>
            </div><!-- /.code-block -->

            <h3>The Javascript</h3>
            <div class="code-block">
<pre><code data-language="javascript">window.onload = function() {
    require(['$api/models'], function(models) {

        // When application has loaded, run pages function
        models.application.load('arguments').done(pages);

        // When arguments change, run pages function
        models.application.addEventListener('arguments', pages);

        function pages() {
            var args = models.application.arguments;
            var current = document.getElementById(args[0]);
            var sections = document.getElementsByClassName('section');
            for (i=0;i&lt;sections.length;i++){
                sections[i].style.display = 'none';
            }
            current.style.display = 'block';
        }
    });

}</code></pre>
            </div><!-- /.code-block -->

            <h3>The HTML</h3>
            <div class="code-block">
<pre><code data-language="html">&lt;div id="index" class="section"&gt;
<!-- This content will show up in the "Home" tab -->
&lt;/div&gt;

&lt;div id="tabs" class="section"&gt;
<!-- This content will show up in the "How to use tabs" tab -->
&lt;/div&gt;</code></pre>
            </div><!-- /.code-block -->

        </div><!-- /.section #tabs -->

        <div id="manifest" class="section">

            <h1>Creating your manifest file</h1>
            <p class="description">The first step for building a Spotify App is to create a manifest.json file in your app's root directory. The example below is the most minimal manifest.json file needed for an app to work. For more information about the manifest.json file, please read our <a href="http://developer.spotify.com/download/spotify-apps-api/guidelines/#applicationmanifest">API guidelines</a>.</p>

            <h3>The JSON</h3>
            <div class="code-block">
<pre><code data-language="javascript">{
    "AppDescription": {
        "en": "A tutorial app for Spotify Apps API"
    },
    "AppIcon": {
        "36x18": "tutorial.png"
    },
    "AppName": {
        "en": "Spotify Apps Tutorial"
     },
    "BundleIdentifier": "tutorial",
    "BundleType": "Application",
    "BundleVersion": "0.1",
    "DefaultTabs": [
        {
            "arguments": "home_tab",
            "title": {
                "en": "Home"
            }
        },
        {
            "arguments": "secondary_tab",
            "title": {
                "en": "Secondary Tab"
            }
        }
    ],
	"Dependencies": {
	  "api": "0.2.3",
	  "util": "0.1.0",
	  "resources": "0.2.2"
    },
    "RequiredInterface": 1,
    "RequiredPermissions": [
        "http://api.twitter.com",
        "https://graph.facebook.com",
        "https://gist.github.com/"
    ],
    "SupportedLanguages": [
        "en"
    ],
    "VendorIdentifier": "co.mager"
}</code></pre>
            </div><!-- /.code-block -->


        </div><!-- /.section #manifest -->


        <div id="drop" class="section">

            <h1>Dragging and dropping content into an app</h1>
            <p class="description">Using the built-in HTML "Drag &amp; Drop", we are able to detect and use content dragged into a Spotify App. Eric Bidelman from Google wrote <a href="http://www.html5rocks.com/en/tutorials/dnd/basics/">a nice tutorial</a> that I used to build this. You can also drag items from Spotify (albums, tracks, playlists) into your app via the sidebar.</p>
            <h3>The manifest.json snippet</h3>
            <div class="code-block">
<pre><code data-language="javascript">{
    ...
    "ApplicationLinkTypes": [
        "album",
        "artist",
        "playlist",
        "track",
        "user"
    ],
    ...
}</code></pre>
            </div><!-- /.code-block -->


            <h3>The Javascript</h3>
            <div class="code-block">
<pre><code data-language="javascript">window.onload = function() {
    // Drag content into an HTML element from Spotify
    var dropBox = document.querySelector('#drop-box');
    dropBox.addEventListener('dragstart', function(e){
        e.dataTransfer.setData('text/html', this.innerHTML);
        e.dataTransfer.effectAllowed = 'copy';
    }, false);

    dropBox.addEventListener('dragenter', function(e){
        if (e.preventDefault) e.preventDefault();
        e.dataTransfer.dropEffect = 'copy';
        this.classList.add('over');
    }, false);

    dropBox.addEventListener('dragover', function(e){
        if (e.preventDefault) e.preventDefault();
        e.dataTransfer.dropEffect = 'copy';
        return false;
    }, false);

    dropBox.addEventListener('drop', function(e){
        if (e.preventDefault) e.preventDefault();
        var drop = models.Playlist.fromURI(e.dataTransfer.getData('text'));
        console.log(drop);
        this.classList.remove('over');
        var success_message = document.createElement('p');
        success_message.innerHTML = 'Playlist successfully dropped: ' + drop.uri;
        this.appendChild(success_message);
    }, false);
    
    // Drag content into the sidebar
    models.application.addEventListener('dropped', function(){
        console.log(models.application.dropped);
    });
}</code></pre>
            </div><!-- ./code-block -->

            <h3>The HTML</h3>
            <div class="code-block">
<pre><code data-language="html">&lt;div id="drop-box"&gt;&lt;/div&gt;</code></pre>
            </div><!-- /.code-block -->

            <h3>The CSS</h3>
            <div class="code-block">
<pre><code data-language="html">&lt;style&gt;
    #drop-box {border:4px dashed #333;width:100%;height:200px;padding:10px;}
    #drop-box.over {opacity:0.8;border-color:#74c043;}
&lt;/style&gt;</code></pre>
            </div><!-- /.code-block -->

            <h3>Live Example</h3>
            <div id="drop-box">
            </div>

        </div><!-- /.section #drop -->


        <div id="share" class="section">
             <h1>Show "Share" popup</h1>
            <p class="description">One of the greatest features of Spotify is the ability to share music with your social graph. With a few lines of code, we can interact with the "Share" popup dialog.</p>

            <h3>The Javascript</h3>
            <div class="code-block">
<pre><code data-language="javascript">window.onload = function() {
    // Show share popup
    var shareHTML = document.getElementById('share-popup');
    var shareURI = 'spotify:track:249E7AgSyA4vhtXNEjQYb5';
    var rect = shareHTML.getBoundingClientRect();
    shareHTML.addEventListener('click', showSharePopup);

    function showSharePopup(){
      models.client.showShareUI(shareURI, 'Check out my jam',
        {x:((rect.width/2) + rect.left), y:rect.top});
    }
}</code></pre>
            </div><!-- ./code-block -->

            <h3>The HTML</h3>
            <div class="code-block">
<pre><code data-language="html">&lt;div id="share-button"&gt;
    &lt;button id="share-popup" class="sp-button"&gt;Share&lt;/button&gt;
&lt;/div&gt;</code></pre>
            </div><!-- /.code-block -->

            <h3>Live Example</h3>
            <div id="share-button">
                <button id="share-popup" class="sp-button">Share</button>
            </div>

        </div><!-- /.section #share-popup -->

        <div id="play_single_track" class="section">
            <h1>Play a single track</h1>
            <p class="description">This snippet of code plays a hardcoded Spotify URI.</p>

            <h3>The Javascript</h3>
            <div id="the-js">
<pre><code data-language="javascript">window.onload = function() {
    require('$views/image#Image', function(Image) {
        // Play a single track
        var single_track = models.Track.fromURI('spotify:track:0blzOIMnSXUKDsVSHpZtWL');
        var image = Image.forTrack(single_track, {player:true});

        // Pass the player HTML code to the #single-track-player div 
        var single_track_player_HTML = document.getElementById('single-track-player');
        single_track_player_HTML.appendChild(image.node);
    }
}</code></pre>
        </div>

        <h3>The HTML</h3>
        <div id="the-html">
<pre><code data-language="html">&ltdiv id="single-track-player"&gt;&lt;/div&gt;</code></pre>
        </div>

        <h3>The CSS</h3>
        <div id="the-css">
<pre><code data-language="css">&lt;style&gt; 
@import url('$views/css/image.css');                            
&lt;/style&gt;</code></pre>
        </div>

        <h3>Live Example</h3>
        <div id="single-track-player"></div>


    </div><!-- /.section #play_single_track -->


    <div id="play_list_of_tracks" class="section">
        <h1>Play a list of tracks</h1>
        <p class="description">This snippet of code retrieves the user's 20 latest songs added to their Library and creates a Player & List view of the songs.</p>

        <h3>The Javascript</h3>
        <div id="the-js">
<pre><code data-language="javascript">window.onload = function() {
/* Instantiate the global sp object; include models &amp; views */
var sp = getSpotifyApi(1);
var models = sp.require("sp://import/scripts/api/models");
var views = sp.require("sp://import/scripts/api/views");

var library_tracks = models.library.tracks;

var multiple_tracks_playlist = new models.Playlist();
for(var i=0;i&lt;20;i++) {
    var library_track = models.Track.fromURI(library_tracks[i].data.uri);
    multiple_tracks_playlist.add(library_track);
}

console.log(multiple_tracks_playlist);
var multiple_tracks_player = new views.List(multiple_tracks_playlist);
multiple_tracks_player.track = null; // Don't play the track right away
multiple_tracks_player.context = multiple_tracks_playlist;

/* Pass the player HTML code to #multiple-tracks-player */
var multiple_tracks_player_HTML = document.getElementById('multiple-tracks-player');
multiple_tracks_player_HTML.appendChild(multiple_tracks_player.node);
single_track_player_HTML.appendChild(single_track_player.node);
}</code></pre>
        </div>

        <h3>The HTML</h3>
        <div id="the-html">
<pre><code data-language="html">&ltdiv id="multiple-tracks-player"&gt;&lt;/div&gt;</code></pre>
        </div>

        <h3>The CSS</h3>
        <div id="the-css">
<pre><code data-language="css">&lt;style&gt; 
@import url("sp://import/css/api.css");                               
@import url('sp://import/css/eve.css');                               
@import url('sp://import/css/player.css');                            
&lt;/style&gt;</code></pre>
        </div>

            <h3>Live Example</h3>
            <div id="multiple-tracks-player"></div>
 
        </div><!-- /.section #play_list_of_tracks -->


        <div id="current_track" class="section">
            <h1>Get the currently-playing track</h1>
            <p class="description">Checks to see which track is currently playing. This example also updates the DOM when the song changes.</p>

            <h3>The Javascript</h3>
            <div id="the-js">
<pre><code data-language="javascript">window.onload = function() {
    // Get the currently-playing track
    models.player.load('track').done(updateCurrentTrack);

    // Update the DOM when the song changes
    models.player.addEventListener('change', updateCurrentTrack);

    function updateCurrentTrack(){
        var currentHTML = document.getElementById('current-track');
        if (models.player.track == null) {
            currentHTML.innerHTML = 'No track currently playing';
        } else {
            var artists = models.player.track.artists;
            console.log(artists);
            var artists_array = [];
            for(i=0;i&lt;artists.length;i++) {
                artists_array.push(artists[i].name);
            }
            currentHTML.innerHTML = 'Now playing: ' + artists_array.join(', ');
            currentHTML.innerHTML += ' - ' + models.player.track.name;
        }
    }
}</code></pre>

            <h3>The HTML</h3>
            <div id="the-html">
<pre><code data-language="html">&ltdiv id="example"&gt;&lt;/div&gt;</code></pre>
            </div>

            <h3>The CSS</h3>
            <div id="the-css">
<pre><code data-language="css">&lt;style&gt; 
    @import url("sp://import/css/api.css");                               
    @import url('sp://import/css/eve.css');                               
&lt;/style&gt;</code></pre>
            </div>

            <h3>Live Example</h3>
            <div id="current-track"></div>
 
        </div><!-- /.section #template -->


        <div id="template" class="section">
            <h1>Title</h1>
            <p class="description">Description</p>

            <h3>The Javascript</h3>
            <div id="the-js">
<pre><code data-language="javascript">window.onload = function() {
}</code></pre>

            <h3>The HTML</h3>
            <div id="the-html">
<pre><code data-language="html">&ltdiv id="example"&gt;&lt;/div&gt;</code></pre>
            </div>

            <h3>The CSS</h3>
            <div id="the-css">
<pre><code data-language="css">&lt;style&gt; 
    @import url("sp://import/css/api.css");                               
    @import url('sp://import/css/eve.css');                               
&lt;/style&gt;</code></pre>
            </div>

            <h3>Live Example</h3>
            <div id="example"></div>
 
        </div><!-- /.section #template -->



        </div><!-- /wrapper -->
    </body>
</html>
